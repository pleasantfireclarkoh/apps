<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pleasant Township Hazard Monitor</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; 
            background-color: #222;
            font-family: Arial, sans-serif;
        }

        #map {
            height: 100%;
            width: 100%;
            background: #242f3e; 
        }

        /* Title Overlay */
        .header-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px 30px;
            border-radius: 50px;
            border: 2px solid #e74c3c;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        h1 { margin: 0; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 2px; }
        p { margin: 0; font-size: 0.9rem; color: #ccc; }

        /* Custom Hazard Icon Styling */
        .hazard-icon {
            text-align: center;
            line-height: 40px;
            font-size: 20px;
            color: white;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .icon-closure { background-color: #c0392b; border: 2px solid white; } /* Red */
        .icon-accident { background-color: #d35400; border: 2px solid white; } /* Orange */
        .icon-construction { background-color: #f39c12; border: 2px solid white; } /* Yellow */

        /* Legend Overlay */
        .legend {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            color: white;
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
        .dot { height: 15px; width: 15px; border-radius: 50%; margin-right: 10px; display: inline-block; }
    </style>
</head>
<body>

    <div class="header-overlay">
        <h1>Roadway Hazard Monitor</h1>
        <p>Pleasant Township, OH â€¢ Live Feed</p>
    </div>

    <div id="map"></div>

    <div class="legend">
        <div class="legend-item"><span class="dot" style="background:#c0392b;"></span>Road Closure</div>
        <div class="legend-item"><span class="dot" style="background:#d35400;"></span>Accident/Hazard</div>
        <div class="legend-item"><span class="dot" style="background:#f39c12;"></span>Construction</div>
        <div class="legend-item"><span class="dot" style="border: 2px solid #3498db;"></span>Township Boundary</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        // --- CONFIGURATION ---
        
        // 1. Google Sheet CSV Link (File > Share > Publish to Web > CSV)
        // REPLACE THE LINK BELOW with your actual CSV link
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRFwKf1UaKCKLASXnjnKprBD_dUoNxfj2ypNjC5x_vAzO6AmNJagIe86-uTkvGs_2xsXUthRDydbayG/pub?gid=657202760&single=true&output=csv';

        // 2. OHGO API Key (Optional - leave blank if you don't have one yet)
        const OHGO_API_KEY = '2bd6a482-97de-478e-812d-50b245075206'; 
        
        // 3. Set to true if you want to see test markers without real data
        const USE_MOCK_DATA = false; 

        // ---------------------

        // The Polygon Data (Pleasant Township)
        const townshipGeoJSON = { "type": "Feature", "properties": { "OBJECTID": 4538, "NAME": "Pleasant", "AREA": 0, "PERIMETER": 150888.46723000001, "ACRES": 26534.2, "GLOBALID": "{25CF87C1-BF61-450C-8DB5-0AD06EF34D40}", "SHAPE_Length": 60042.894667662978, "SHAPE_Area": 183088904.87500378, "StateCode": "OH", "CityCode": "PLT" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -83.669722869975615, 40.018676694230805 ], [ -83.673252152199225, 40.018910969374168 ], [ -83.673255068130644, 40.018878517661484 ], [ -83.673384771382942, 40.017447263519934 ], [ -83.673447000377621, 40.016760361799079 ], [ -83.674067601491643, 40.009909501747451 ], [ -83.674098802676411, 40.009565196754224 ], [ -83.674572443901539, 40.004334876229237 ], [ -83.675224430354987, 39.997016949482315 ], [ -83.675872505543651, 39.989741235004679 ], [ -83.676199587528501, 39.986951125025335 ], [ -83.676711522137552, 39.982583940052422 ], [ -83.67672218513998, 39.982492933112695 ], [ -83.676712417757898, 39.982495749053655 ], [ -83.676760875579276, 39.981989787789232 ], [ -83.676796339270041, 39.981619051758443 ], [ -83.676801958232161, 39.981560330593474 ], [ -83.676864510620334, 39.980906964487119 ], [ -83.676869416320102, 39.980855713289877 ], [ -83.67694246911563, 39.980092399334339 ], [ -83.676949524483874, 39.980018673565873 ], [ -83.677014153776994, 39.979342848134749 ], [ -83.677042985206029, 39.979041346854281 ], [ -83.677136118043123, 39.978266583650928 ], [ -83.677165997806085, 39.978018013365606 ], [ -83.677177599548003, 39.977921506448624 ], [ -83.677203756692421, 39.977672305045523 ], [ -83.677232904328463, 39.977394611495853 ], [ -83.6772416638008, 39.977309225135279 ], [ -83.677272764374251, 39.977007223378017 ], [ -83.677333552471211, 39.97641655267158 ], [ -83.677481994580319, 39.9752856445525 ], [ -83.677576595264583, 39.974603762534052 ], [ -83.677577096524516, 39.974600280579914 ], [ -83.677823852953281, 39.972886576568925 ], [ -83.677909276448588, 39.972293102765207 ], [ -83.677911415337277, 39.972278271258219 ], [ -83.678531784685973, 39.968252800480194 ], [ -83.678544733002482, 39.968169729727158 ], [ -83.678552906773248, 39.968117309592863 ], [ -83.678552920247967, 39.968117222845528 ], [ -83.6785863169153, 39.967906945000273 ], [ -83.678611688932179, 39.967748136181889 ], [ -83.678976144426088, 39.9654670097744 ], [ -83.67897638786954, 39.96546547924482 ], [ -83.679280463999959, 39.96348037143828 ], [ -83.679484268381742, 39.962104309564403 ], [ -83.679524872232562, 39.96182544697718 ], [ -83.679812890078964, 39.959847341425771 ], [ -83.67982596505793, 39.959756585827492 ], [ -83.679825982125919, 39.959756473593053 ], [ -83.679917570759017, 39.959127436610018 ], [ -83.67997608162672, 39.958714637434454 ], [ -83.679984182633973, 39.958658403658276 ], [ -83.680142620297275, 39.957558633208656 ], [ -83.680266419821507, 39.956685479678264 ], [ -83.680336062612241, 39.956194260803386 ], [ -83.680451921927684, 39.955376834713768 ], [ -83.680546691495195, 39.954708230801437 ], [ -83.68062747878534, 39.954138326671348 ], [ -83.680770632512392, 39.953128311520068 ], [ -83.680851413514304, 39.952558487189648 ], [ -83.680997717633048, 39.951526393712328 ], [ -83.681246250929448, 39.949589925348725 ], [ -83.681315297238825, 39.949051983484601 ], [ -83.681597651207341, 39.947022458461142 ], [ -83.681679466170181, 39.946434339896591 ], [ -83.681694466238767, 39.946326487676288 ], [ -83.681744002936824, 39.945971431222084 ], [ -83.681744005631757, 39.945971418825593 ], [ -83.681744373941015, 39.945968775619406 ], [ -83.681744744046924, 39.945966117950576 ], [ -83.681745112356182, 39.945963462347692 ], [ -83.681745480665455, 39.945960804678649 ], [ -83.681745846279782, 39.945958149764266 ], [ -83.68174621458904, 39.945955494161083 ], [ -83.681746580203352, 39.94595283649172 ], [ -83.681746945817665, 39.945950178822216 ], [ -83.681747308737044, 39.945947523907421 ], [ -83.681747671656424, 39.94594486623776 ], [ -83.681748034575804, 39.945942208567992 ], [ -83.681748397495184, 39.945939553652885 ], [ -83.681748760414564, 39.945936895982861 ], [ -83.681749120638983, 39.945934238312788 ], [ -83.681749480863417, 39.945931583397368 ], [ -83.681749838392889, 39.945928925727095 ], [ -83.681750198617323, 39.945926268056702 ], [ -83.68175055614681, 39.945923611074861 ], [ -83.68175091098135, 39.945920953404269 ], [ -83.681751269409133, 39.945918296422228 ], [ -83.681751624243674, 39.945915638751423 ], [ -83.681751979078214, 39.945912981769226 ], [ -83.681752333912755, 39.945910324098165 ], [ -83.681752686950659, 39.945907667115769 ], [ -83.681753039090253, 39.945905009444552 ], [ -83.681753391229847, 39.945902352461879 ], [ -83.681753744267752, 39.945899694790469 ], [ -83.681754093712399, 39.945897035741531 ], [ -83.681754444055372, 39.945894378069909 ], [ -83.681754793499991, 39.94589172108688 ], [ -83.681755140249706, 39.945889063414995 ], [ -83.681755490592664, 39.945886404365702 ], [ -83.681755837342351, 39.94588374669361 ], [ -83.68175618229543, 39.945881087644104 ], [ -83.681756527248496, 39.945878430660514 ], [ -83.68175687130325, 39.945875770922093 ], [ -83.681757216256315, 39.945873113938298 ], [ -83.681757560311084, 39.945870456954445 ], [ -83.681757902569203, 39.945867797215662 ], [ -83.681758244827321, 39.945865138165487 ], [ -83.681758586187129, 39.945862481181337 ], [ -83.681758925750316, 39.945859822130949 ], [ -83.681759265313474, 39.945857162391754 ], [ -83.681759604876675, 39.94585450540729 ], [ -83.681759943541522, 39.945851846356604 ], [ -83.681760280409762, 39.945849187305804 ], [ -83.681760617277973, 39.945846527566253 ], [ -83.681760954146228, 39.945843870581314 ], [ -83.681761288319493, 39.945841211530265 ], [ -83.681761625187747, 39.945838552479053 ], [ -83.681761959361026, 39.945835893427741 ], [ -83.681762290839359, 39.945833233687672 ], [ -83.681762624114327, 39.945830574636155 ], [ -83.681762955592689, 39.94582791558453 ], [ -83.681763285274371, 39.945825256532807 ], [ -83.681763616752733, 39.945822597480969 ], [ -83.681763945536119, 39.945819938429089 ], [ -83.681764277014452, 39.94581727937706 ], [ -83.681764603102906, 39.945814618258844 ], [ -83.681764931886292, 39.945811959206608 ], [ -83.681765257974746, 39.945809300154259 ], [ -83.6817655840632, 39.945806641101811 ], [ -83.681765908355004, 39.945803982049306 ], [ -83.681766234443458, 39.945801320930592 ], [ -83.681766557836966, 39.945798661877824 ], [ -83.681766881230473, 39.945796002824963 ], [ -83.681767202827345, 39.945793341705937 ], [ -83.681767523525892, 39.945790682652863 ], [ -83.681767844224453, 39.945788021533616 ], [ -83.681768165821325, 39.945785362480343 ], [ -83.681768483824939, 39.945782701360891 ], [ -83.6817688045235, 39.945780042307412 ], [ -83.681769120730479, 39.945777381187753 ], [ -83.681769333631181, 39.945775607107912 ], [ -83.681769338122777, 39.945775556833155 ], [ -83.681769438734079, 39.945774720756702 ], [ -83.681769754941058, 39.945772061702911 ], [ -83.681770070249726, 39.94576940058294 ], [ -83.681770386456705, 39.945766741528935 ], [ -83.681770701765373, 39.945764080408772 ], [ -83.681771015277405, 39.945761419288495 ], [ -83.681771328789438, 39.945758758856812 ], [ -83.681771638708199, 39.945756097736329 ], [ -83.681771952220231, 39.94575343868182 ], [ -83.68177226213902, 39.945750777561123 ], [ -83.681772572956106, 39.945748117128986 ], [ -83.681772881078246, 39.945745456008083 ], [ -83.681773189200399, 39.945742794887082 ], [ -83.681773496424213, 39.94574013376598 ], [ -83.681773804546353, 39.94573747333348 ], [ -83.681774112668492, 39.945734812212166 ], [ -83.681774418095699, 39.945732151090752 ], [ -83.681774723522892, 39.945729490657889 ], [ -83.681775026255139, 39.945726829536262 ], [ -83.681775330784035, 39.94572416703717 ], [ -83.681775633516281, 39.945721505915287 ], [ -83.681775936248542, 39.945718844793355 ], [ -83.681776236285828, 39.94571618436003 ], [ -83.681776536323127, 39.945713523237892 ], [ -83.681776836360456, 39.945710860738224 ], [ -83.681777136397741, 39.945708199615879 ], [ -83.681777433740123, 39.945705539182136 ], [ -83.681777731980787, 39.945702878059578 ], [ -83.681778029323141, 39.945700215559505 ], [ -83.681778326665494, 39.945697554436748 ], [ -83.681778621312915, 39.945694891936462 ], [ -83.681778915960322, 39.945692230813499 ], [ -83.681779210607743, 39.945689568313057 ], [ -83.681779503458529, 39.945686907189831 ], [ -83.68177979810595, 39.94568424468919 ], [ -83.681780087363464, 39.945681581499684 ], [ -83.681780379315924, 39.945678921064903 ], [ -83.681780669471763, 39.945676258563893 ], [ -83.681780958729277, 39.945673595374132 ], [ -83.68178124888513, 39.945670934939038 ], [ -83.681781538142644, 39.945668272437722 ], [ -83.681781824705212, 39.945665609247648 ], [ -83.681782112166104, 39.945662948812192 ], [ -83.6817823987287, 39.945660286310613 ], [ -83.681782683494632, 39.945657623120177 ], [ -83.681782967362253, 39.945654960618391 ], [ -83.681783252128199, 39.945652298116457 ], [ -83.68178353599582, 39.945649635614409 ], [ -83.681783818066847, 39.94564697242361 ], [ -83.681784099239522, 39.945644309921356 ], [ -83.681784381310521, 39.945641647419059 ], [ -83.68178466068656, 39.945638984916599 ], [ -83.681784941859249, 39.945636321725374 ], [ -83.681785218540355, 39.945633659222715 ], [ -83.681785497916408, 39.945630996719949 ], [ -83.681785774597515, 39.945628334217133 ], [ -83.681786053075257, 39.945625671714154 ], [ -83.681786327061417, 39.945623009211076 ], [ -83.681786603742538, 39.945620346019233 ], [ -83.681786877728683, 39.945617681449875 ], [ -83.681787151714857, 39.945615018946484 ], [ -83.681787425701017, 39.945612356443043 ], [ -83.681787696992231, 39.945609693939453 ], [ -83.681787967385134, 39.945607029369668 ], [ -83.681788238676347, 39.945604366865865 ], [ -83.681788509967561, 39.945601704362005 ], [ -83.681788778563828, 39.945599039791922 ], [ -83.681789047160109, 39.945596377287814 ], [ -83.681789315756376, 39.945593712717518 ], [ -83.681789585250954, 39.945591050213238 ], [ -83.681789851152274, 39.945588385642736 ], [ -83.681790117053595, 39.945585723138208 ], [ -83.681790380259983, 39.945583058567493 ], [ -83.681790646161318, 39.945580396062759 ], [ -83.681790733297888, 39.945579507642904 ], [ -83.681790909367692, 39.945577731491838 ], [ -83.681791172574052, 39.945575066920824 ], [ -83.681791433983818, 39.945572405104542 ], [ -83.681791697190192, 39.945569740533301 ], [ -83.68179195770162, 39.945567075961975 ], [ -83.681792216416412, 39.945564413456616 ], [ -83.681792476927853, 39.945561748885076 ], [ -83.681792734744349, 39.945559084313437 ], [ -83.68179299345914, 39.9455564204304 ], [ -83.681793248580675, 39.945553757924621 ], [ -83.681793507295481, 39.94555109335267 ], [ -83.681793762417016, 39.945548428780604 ], [ -83.681794017538564, 39.945545764208454 ], [ -83.681794270863477, 39.94554310032489 ], [ -83.681794525985026, 39.945540435752527 ], [ -83.681794776614979, 39.945537771180049 ], [ -83.681795029939892, 39.945535106607473 ], [ -83.681795282366494, 39.945532442723497 ], [ -83.681795532996446, 39.945529778150714 ], [ -83.681795780033156, 39.945527113577825 ], [ -83.681796030663122, 39.945524449693544 ], [ -83.681796278598142, 39.945521785120448 ], [ -83.681796526533162, 39.945519120547246 ], [ -83.681796773569872, 39.945516456662652 ], [ -83.681797021504877, 39.945513792089251 ], [ -83.681797266744951, 39.945511126138314 ], [ -83.681797511985025, 39.9455084615647 ], [ -83.681797753631841, 39.945505796990979 ], [ -83.6817979988719, 39.945503133105866 ], [ -83.681798241417027, 39.945500466465859 ], [ -83.681798483962169, 39.94549780258054 ], [ -83.681798723812349, 39.945495138006414 ], [ -83.681798963662516, 39.945492472054745 ], [ -83.681799203512711, 39.945489807480413 ], [ -83.681799443362877, 39.945487143594676 ], [ -83.681799683213058, 39.94548447695405 ], [ -83.681799920368292, 39.945481813068099 ], [ -83.68180015752354, 39.945479146427218 ], [ -83.681800391983813, 39.945476482541068 ], [ -83.681800626444115, 39.945473816588731 ], [ -83.681800860904403, 39.945471152013667 ], [ -83.681801096263001, 39.945468486061067 ], [ -83.681801330723303, 39.945465819419717 ], [ -83.68180156248863, 39.945463155533041 ], [ -83.681801794253985, 39.945460489580142 ], [ -83.681802026019326, 39.94545782500456 ], [ -83.681802255988046, 39.945455159051491 ], [ -83.681802485058441, 39.945452493098273 ], [ -83.681802714128835, 39.945449826456297 ], [ -83.681802941402594, 39.94544716256901 ], [ -83.681803170472989, 39.945444496615472 ], [ -83.681803396848451, 39.945441829973191 ], [ -83.681803621427278, 39.945439164019447 ], [ -83.681803847802712, 39.945436500131741 ], [ -83.681804072381539, 39.945433834177855 ], [ -83.681804296062055, 39.945431167535098 ], [ -83.68180451794592, 39.945428501580992 ], [ -83.681804741626422, 39.945425835626743 ], [ -83.681804963510288, 39.945423169672438 ], [ -83.681805181800925, 39.945420503717969 ], [ -83.681805403684791, 39.945417837074743 ], [ -83.681805622873725, 39.945415171120125 ], [ -83.681805841164348, 39.945412505165351 ], [ -83.681806060353267, 39.945409839210527 ], [ -83.681806276847254, 39.945407173255539 ], [ -83.681806492442931, 39.945404507300509 ], [ -83.681806708936918, 39.945401841345323 ], [ -83.681806925430891, 39.945399175390079 ], [ -83.681807139229917, 39.94539650943468 ], [ -83.681807353028958, 39.945393842790523 ], [ -83.681807565929688, 39.945391175457544 ], [ -83.681807777033768, 39.945388508813124 ], [ -83.681807988137876, 39.945385842857355 ], [ -83.681808138156526, 39.945383866289703 ], [ -83.681808191157117, 39.945383175524078 ], [ -83.681748055237065, 39.945379276795819 ], [ -83.681737096688892, 39.945378563991738 ], [ -83.680751192969637, 39.945314503880425 ], [ -83.676593267015235, 39.9450442849216 ], [ -83.67330056869811, 39.944830186120718 ], [ -83.672324340732757, 39.944763596568329 ], [ -83.670563658047229, 39.944643475843677 ], [ -83.665705382141155, 39.944311884661914 ], [ -83.665445437545685, 39.944294137283123 ], [ -83.663949148811241, 39.944191971135055 ], [ -83.662109213158075, 39.944066319043245 ], [ -83.662070321496188, 39.944063664055349 ], [ -83.66203815731744, 39.944061458108088 ], [ -83.662011695644097, 39.944059660567518 ], [ -83.66195306350383, 39.94405565639078 ], [ -83.661905077297988, 39.944052628120055 ], [ -83.659267823948113, 39.943886113657634 ], [ -83.659249867523897, 39.943884980722096 ], [ -83.655322743020491, 39.943636912150623 ], [ -83.652514393846673, 39.943459454311238 ], [ -83.652479120598741, 39.943457221484508 ], [ -83.652479102632427, 39.943457221484508 ], [ -83.647181087021721, 39.943122216755533 ], [ -83.647161057285814, 39.943120950883944 ], [ -83.644124952848131, 39.94292886458225 ], [ -83.643349018648422, 39.942879753704339 ], [ -83.642222717233381, 39.94280728673688 ], [ -83.642201251989675, 39.942805893445247 ], [ -83.64220123312505, 39.942805894133983 ], [ -83.639491081489879, 39.942630026476671 ], [ -83.638368479337203, 39.942557163914827 ], [ -83.63565736919962, 39.942381162004608 ], [ -83.635657348538373, 39.942381162004608 ], [ -83.635405310015742, 39.942364795717246 ], [ -83.635405293846048, 39.942364795717246 ], [ -83.63502774810182, 39.942340280370992 ], [ -83.634748430438933, 39.942322126129859 ], [ -83.634748413370957, 39.942322124063637 ], [ -83.634748394506346, 39.942322122686207 ], [ -83.634564125787051, 39.942310148419118 ], [ -83.634086284937965, 39.942279106640605 ], [ -83.629552500275437, 39.941984546177572 ], [ -83.625231153702856, 39.94170362349842 ], [ -83.625230404507917, 39.941703575975616 ], [ -83.623887204867543, 39.941617838548026 ], [ -83.619808823833239, 39.94135734859551 ], [ -83.619535454814184, 39.941339886966254 ], [ -83.619100412400172, 39.941312094914181 ], [ -83.618021635456955, 39.94124316710505 ], [ -83.61160681182713, 39.940833079711453 ], [ -83.611571219677259, 39.940830810295459 ], [ -83.611500094666326, 39.940826266642098 ], [ -83.611428931926142, 39.940821477106319 ], [ -83.611393405353283, 39.940819092669443 ], [ -83.611018291348529, 39.94079388733492 ], [ -83.610611092216743, 39.940766518639869 ], [ -83.609342946818359, 39.940681306240783 ], [ -83.606382933278482, 39.940482337310343 ], [ -83.604607571222928, 39.940389189471155 ], [ -83.597708457738591, 39.939963272147061 ], [ -83.597686907154937, 39.939961940785366 ], [ -83.596994665397006, 39.939919182916434 ], [ -83.596765455760675, 39.939905023499016 ], [ -83.596762994376789, 39.93990487128422 ], [ -83.596582302748956, 39.939893709324792 ], [ -83.59653834369054, 39.939890992875789 ], [ -83.595418351143763, 39.939820672349001 ], [ -83.595111850460398, 39.939802862505985 ], [ -83.595069179586091, 39.939800225949057 ], [ -83.592482525641216, 39.939640371064201 ], [ -83.592147177359138, 39.939619640153524 ], [ -83.591634944509408, 39.939587973139787 ], [ -83.590989985576442, 39.939548100934438 ], [ -83.590811925114082, 39.939537097331254 ], [ -83.590749353861284, 39.939533227197764 ], [ -83.5902618148004, 39.939503085744612 ], [ -83.590136158458463, 39.939443333832045 ], [ -83.590137864359178, 39.939495423303285 ], [ -83.589009751940537, 39.939425656821399 ], [ -83.587760689453731, 39.939348411709489 ], [ -83.587579191138786, 39.93933718491585 ], [ -83.586255597229481, 39.939253390273706 ], [ -83.584060485679316, 39.939114384337422 ], [ -83.583208246782746, 39.939060403232446 ], [ -83.579270416157797, 39.938810905888268 ], [ -83.577801971603876, 39.938717834981958 ], [ -83.572996229175587, 39.938413107412224 ], [ -83.569983930092945, 39.938221997658992 ], [ -83.569897738538046, 39.93821651985801 ], [ -83.569383872551128, 39.938183908577287 ], [ -83.568590105894728, 39.938133531085001 ], [ -83.568589097086658, 39.938133663329303 ], [ -83.565731532811682, 39.937952672957813 ], [ -83.561514431236262, 39.937717191626241 ], [ -83.560757587134646, 39.937674912432378 ], [ -83.555974388826741, 39.937407598881556 ], [ -83.55541580739991, 39.937376387505431 ], [ -83.552202971108173, 39.937196714148513 ], [ -83.551120440105365, 39.937136137815699 ], [ -83.549884107644459, 39.937066964037179 ], [ -83.548365255026681, 39.9369819639981 ], [ -83.547072603587353, 39.936909611321809 ], [ -83.54410616709319, 39.936743494814451 ], [ -83.536804642497557, 39.936334330296788 ], [ -83.53646663160896, 39.937297095778547 ], [ -83.536013232122158, 39.938588490683955 ], [ -83.535460391828309, 39.94016304567171 ], [ -83.535342593948457, 39.940498547702028 ], [ -83.535236117536144, 39.940801804466759 ], [ -83.535236116637833, 39.940801818241695 ], [ -83.53505074658402, 39.94132971978199 ], [ -83.53460601494136, 39.942596316023867 ], [ -83.534225623334308, 39.94367958505039 ], [ -83.534030278387561, 39.944235892321849 ], [ -83.533476661949322, 39.945812424075903 ], [ -83.53329444138889, 39.946331306440385 ], [ -83.533274218515217, 39.946388886409814 ], [ -83.533253992048273, 39.946446445670126 ], [ -83.533253990251637, 39.946446457377881 ], [ -83.532917710416612, 39.947404013284768 ], [ -83.532139538513519, 39.949619774499752 ], [ -83.530724989283414, 39.953647125309175 ], [ -83.530724983893506, 39.953647139770105 ], [ -83.52996146351272, 39.955820724115661 ], [ -83.529327079547286, 39.957626597098596 ], [ -83.529303699095365, 39.957693129372309 ], [ -83.529280354576088, 39.957759634726855 ], [ -83.527097283145679, 39.963973268894648 ], [ -83.526360209166839, 39.96607092942449 ], [ -83.52636020377696, 39.966070941817335 ], [ -83.526296372187801, 39.966273556229311 ], [ -83.524281563294934, 39.972667765913229 ], [ -83.523902234394853, 39.973871437863963 ], [ -83.521872853031454, 39.980310411827723 ], [ -83.521821282547606, 39.980474034662585 ], [ -83.521771959648632, 39.980630494192106 ], [ -83.521771951563792, 39.980630510712352 ], [ -83.520893393826029, 39.983417642367158 ], [ -83.519631122511285, 39.987421654266846 ], [ -83.519590474642996, 39.987550624712149 ], [ -83.519487383980987, 39.98787763296076 ], [ -83.518181945921881, 39.992017999980114 ], [ -83.514893551433289, 40.002445299325345 ], [ -83.5125136869719, 40.009989790202624 ], [ -83.512430380805696, 40.010253850415005 ], [ -83.51248737172395, 40.010256786307551 ], [ -83.514741493605143, 40.010372896732385 ], [ -83.517418933987571, 40.010510765650636 ], [ -83.527204001204794, 40.011014052473072 ], [ -83.530088399055629, 40.011162259915899 ], [ -83.534545394829365, 40.011391126070968 ], [ -83.53464786565381, 40.011396400544186 ], [ -83.534750336478268, 40.011401646119474 ], [ -83.539095531525007, 40.01162459989888 ], [ -83.541420453227005, 40.011743822713669 ], [ -83.543312640286956, 40.011830001990063 ], [ -83.544034071003423, 40.011862847167578 ], [ -83.552394131702314, 40.012243263323043 ], [ -83.553321994372752, 40.012285448249905 ], [ -83.553524639927815, 40.012294663664221 ], [ -83.553604324985088, 40.012298284742371 ], [ -83.555334610478013, 40.012376923256625 ], [ -83.556579938668179, 40.012433504318885 ], [ -83.557101752050428, 40.012457212937598 ], [ -83.559481418882456, 40.012565278697487 ], [ -83.560632658428091, 40.012617543640118 ], [ -83.562073864265955, 40.012687534044233 ], [ -83.562172726557918, 40.012692324050079 ], [ -83.562271588849882, 40.012697139512419 ], [ -83.562421793453595, 40.012704426347192 ], [ -83.563665639423547, 40.012764819461147 ], [ -83.565875039576625, 40.012872031589595 ], [ -83.57295976027001, 40.013215543131984 ], [ -83.577966344436248, 40.013458055348899 ], [ -83.57868050418881, 40.013492625968674 ], [ -83.579852641242908, 40.013549356092788 ], [ -83.580746887158767, 40.013592522006135 ], [ -83.582486639996489, 40.013676481486968 ], [ -83.582653136446183, 40.013684500261476 ], [ -83.582823142613719, 40.013692706174119 ], [ -83.583336726529637, 40.013717479396711 ], [ -83.586390319369286, 40.013864745964185 ], [ -83.588889408235204, 40.013985208785229 ], [ -83.590959782419958, 40.014084974756251 ], [ -83.591393945383302, 40.014105894995993 ], [ -83.59146529856632, 40.014109321271988 ], [ -83.591536594257164, 40.01411299110238 ], [ -83.598978223697756, 40.014494450801365 ], [ -83.60820074252787, 40.014979846435914 ], [ -83.611615069141209, 40.01515937526505 ], [ -83.612992411948909, 40.015231761416267 ], [ -83.615452809477219, 40.015361030219829 ], [ -83.61625988197963, 40.015403425809794 ], [ -83.624115735377501, 40.015815789694379 ], [ -83.632267393218669, 40.016243105146181 ], [ -83.632351553682696, 40.016247512382449 ], [ -83.634320580835436, 40.0163506475471 ], [ -83.635407547719097, 40.01640756930702 ], [ -83.636175291978361, 40.016447746875627 ], [ -83.63640078348773, 40.016459566433561 ], [ -83.636604732498256, 40.016473170618433 ], [ -83.636604918449507, 40.016473185066076 ], [ -83.636989436018681, 40.016498822762145 ], [ -83.636989632749732, 40.016498834457899 ], [ -83.637578587114604, 40.016538099019677 ], [ -83.638126580997508, 40.016574628141022 ], [ -83.645289295220479, 40.017051912861 ], [ -83.651475800342723, 40.017463774195583 ], [ -83.65444979795663, 40.017661668769158 ], [ -83.663475760012702, 40.018261764323803 ], [ -83.663908387755214, 40.018290516453845 ], [ -83.663908408416475, 40.018290515765862 ], [ -83.669722869975615, 40.018676694230805 ] ], [ [ -83.623100313916311, 40.003401910628654 ], [ -83.622971101144159, 40.0034138535541 ], [ -83.62297106700818, 40.003413856306558 ], [ -83.617683658704337, 40.003893971050893 ], [ -83.617637714369138, 40.003898141686555 ], [ -83.617280397786786, 40.003975584310737 ], [ -83.617279761779557, 40.003975722620758 ], [ -83.617263014487705, 40.003924194907889 ], [ -83.617248004537629, 40.003878013085689 ], [ -83.617013456213584, 40.003156345287366 ], [ -83.617032050441651, 40.003147107995794 ], [ -83.617063433984413, 40.003053563145308 ], [ -83.617064888356865, 40.003049226621407 ], [ -83.617302517004021, 40.002340623766848 ], [ -83.617571307310087, 40.001539121047152 ], [ -83.617657791715729, 40.001281253383773 ], [ -83.617748975208656, 40.001009284086422 ], [ -83.617819348329689, 40.000799531348292 ], [ -83.617821581541492, 40.000792868075045 ], [ -83.617872847496429, 40.00063994842467 ], [ -83.617933589779327, 40.000458765642236 ], [ -83.618056893433533, 40.000091144621393 ], [ -83.61831620292007, 39.998972792971678 ], [ -83.618380561820302, 39.998695221782505 ], [ -83.618381128657234, 39.998692776740796 ], [ -83.618922824451658, 39.99636298038893 ], [ -83.618942051992008, 39.99628024454325 ], [ -83.619004043831453, 39.996253023992502 ], [ -83.619884353284007, 39.995866351160231 ], [ -83.620655204815847, 39.995527716260824 ], [ -83.622117602809581, 39.994885314641472 ], [ -83.62306313085007, 39.99449225647038 ], [ -83.623136395648004, 39.994462701503032 ], [ -83.623209698175202, 39.994433146522894 ], [ -83.623398533031093, 39.994356995850232 ], [ -83.624041743842497, 39.994097553970683 ], [ -83.624095774811892, 39.994238066128077 ], [ -83.624128822034578, 39.994323969510198 ], [ -83.624294519881985, 39.994736470372459 ], [ -83.624620098087036, 39.995546854258983 ], [ -83.624722202398871, 39.995800994309455 ], [ -83.624949678286683, 39.996367180388503 ], [ -83.625062450990811, 39.996647903973461 ], [ -83.625113360314614, 39.996767280946472 ], [ -83.625521959919894, 39.99779674254804 ], [ -83.625562510770152, 39.997898910497113 ], [ -83.625721482032702, 39.998455483410673 ], [ -83.625755465299903, 39.998537023344291 ], [ -83.625782785762652, 39.998602544800313 ], [ -83.626235578886664, 39.999688504298518 ], [ -83.626877181713724, 40.001272110113241 ], [ -83.626120095965319, 40.001818968711873 ], [ -83.624134688033365, 40.003253044323841 ], [ -83.62407985397013, 40.003292661940129 ], [ -83.62405039102542, 40.00331394606043 ], [ -83.624015885837039, 40.003317131349448 ], [ -83.623306124236123, 40.003382838138528 ], [ -83.623290662433448, 40.003338317061583 ], [ -83.623100313916311, 40.003401910628654 ] ] ] } };

        const map = L.map('map', {
            zoomControl: false,
            dragging: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            keyboard: false,
            touchZoom: false
        });

        // Add OpenStreetMap Tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        // Add Township Boundary
        const townshipLayer = L.geoJSON(townshipGeoJSON, {
            style: {
                color: "#3498db",
                weight: 4,
                opacity: 0.9,
                fillColor: "#3498db",
                fillOpacity: 0.1
            }
        }).addTo(map);

        // Auto-center the map
        map.fitBounds(townshipLayer.getBounds());

        function getIcon(type) {
            let iconClass = 'icon-closure';
            let faIcon = 'fa-road-barrier';

            // Normalize types
            const t = (type || '').toLowerCase();

            if(t.includes('accident')) { iconClass = 'icon-accident'; faIcon = 'fa-car-burst'; }
            if(t.includes('construction')) { iconClass = 'icon-construction'; faIcon = 'fa-person-digging'; }

            return L.divIcon({
                className: 'custom-div-icon',
                html: `<div class='hazard-icon ${iconClass}'><i class='fa-solid ${faIcon}'></i></div>`,
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });
        }

        // Add a marker and store it in our "markers" array so we can clear them on refresh
        let markers = [];
        
        function addMarkerToMap(lat, lng, type, description) {
            const m = L.marker([lat, lng], {icon: getIcon(type)})
             .addTo(map)
             .bindPopup(`<b>${(type || 'HAZARD').toUpperCase()}</b><br>${description}`);
            markers.push(m);
        }

        // Function to clear old markers before refreshing
        function clearMarkers() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];
        }

        // 1. Fetch OHGO (State/Interstate Data)
        async function fetchOhgoData() {
            if(!OHGO_API_KEY) return;
            try {
                const response = await fetch(`https://publicapi.ohgo.com/api/v1/incidents?api_key=${OHGO_API_KEY}`);
                const data = await response.json();
                
                // Filter for rough area around Pleasant Township
                const relevantData = data.results.filter(inc => 
                    inc.latitude > 39.8 && inc.latitude < 40.1 && 
                    inc.longitude > -83.8 && inc.longitude < -83.4
                );

                relevantData.forEach(inc => {
                    let type = 'accident';
                    if(inc.type === 'Construction') type = 'construction';
                    if(inc.closureType === 'Closed') type = 'closure';
                    addMarkerToMap(inc.latitude, inc.longitude, type, inc.description);
                });
            } catch (error) {
                console.error("OHGO Error:", error);
            }
        }

        // 2. Fetch Google Sheet (Local Data)
        function fetchLocalData() {
            if(!GOOGLE_SHEET_URL) return;
            
            Papa.parse(GOOGLE_SHEET_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    results.data.forEach(row => {
                        // Ensure row has valid data
                        if(row.Lat && row.Lng && row.Type) {
                            addMarkerToMap(row.Lat, row.Lng, row.Type, row.Description);
                        }
                    });
                }
            });
        }

        async function refreshAllData() {
            clearMarkers();
            
            // Mock Data for Testing
            if (USE_MOCK_DATA) {
                 addMarkerToMap(39.95, -83.60, 'accident', 'Mock Accident');
                 addMarkerToMap(39.98, -83.55, 'closure', 'Mock Closure');
            } else {
                // Run both fetches
                await fetchOhgoData(); // State roads
                fetchLocalData();      // Local township roads
            }
        }

        // Init
        refreshAllData();

        // Refresh every 5 minutes
        setInterval(refreshAllData, 300000);

    </script>
</body>
</html>